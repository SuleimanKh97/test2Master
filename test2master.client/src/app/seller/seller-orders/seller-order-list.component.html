<div class="container mt-4">
    <h3>طلبات منتجاتي</h3>

    <!-- Loading Indicator -->
    <div *ngIf="!(orderItems$ | async) && !errorMessage" class="text-center">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">جار تحميل الطلبات...</span>
        </div>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="alert alert-danger">
        {{ errorMessage }}
    </div>

    <!-- Order Items Table -->
    <div *ngIf="(orderItems$ | async) as items; else noItems">
        <div *ngIf="items.length > 0; else noItems">
            <table class="table table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th>رقم الطلب</th>
                        <th>تاريخ الطلب</th>
                        <th>صورة المنتج</th>
                        <th>اسم المنتج</th>
                        <th>الكمية</th>
                        <th>السعر (للقطعة)</th>
                        <th>حالة الطلب</th>
                        <th>إجراءات</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of items">
                        <td>{{ item.orderId }}</td>
                        <td>{{ item.orderDate | date:'yyyy/MM/dd hh:mm a' }}</td>
                        <td>
                            <img [src]="item.imageUrl || 'assets/placeholder-image.png'" alt="{{ item.productName }}"
                                width="50" class="rounded">
                        </td>
                        <td>{{ item.productName }}</td>
                        <td>{{ item.quantity }}</td>
                        <td>{{ item.pricePerItem | currency:'ILS' }}</td>
                        <td>
                            <span [ngClass]="getStatusClass(item.orderStatus)">{{ getStatusTranslation(item.orderStatus)
                                }}</span>
                        </td>
                        <td>
                            <!-- Seller Actions based on Current Status -->
                            <div class="btn-group" role="group">
                                <!-- Cancel (if Pending) -->
                                <button *ngIf="item.orderStatus?.toLowerCase() === 'pending'"
                                    class="btn btn-sm btn-danger" (click)="updateStatus(item.orderId, 'Cancelled')">
                                    إلغاء
                                </button>
                                <!-- Mark as Shipped (if Processing) -->
                                <button *ngIf="item.orderStatus?.toLowerCase() === 'processing'"
                                    class="btn btn-sm btn-success" (click)="updateStatus(item.orderId, 'Shipped')">
                                    تم الشحن
                                </button>
                                <!-- Add other actions if needed (e.g., Print Invoice) -->
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- No Items Template -->
    <ng-template #noItems>
        <div *ngIf="!errorMessage" class="alert alert-info text-center mt-3">
            لا توجد طلبات لمنتجاتك حالياً.
        </div>
    </ng-template>

</div>